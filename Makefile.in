#!gmake

LATIN_MODERN_MATH_URI=http://www.gust.org.pl/projects/e-foundry/lm-math/download/latinmodern-math-1959.zip
TEX_GYRE_HEROS_URI=http://www.gust.org.pl/projects/e-foundry/tex-gyre/heros/qhv2.004otf.zip

all: woff \
     mathml-logo-640x200.png \
     mathml-logo-320x100.png \
     mathml-logo-240x75.png \
     mathml-logo.pdf \
     mathml-logo.eps \
     mathml-logo-text-as-path.svg \
     mathml-square-logo-500.png \
     mathml-square-logo-256.png \
     mathml-square-logo-128.png \
     mathml-square-logo-64.png \
     mathml-square-logo.pdf \
     mathml-square-logo.eps \
     mathml-square-logo-text-as-path.svg

woff: latinmodern-math.woff texgyreheros-regular.woff

%-inline-style.svg: %.svg
	@XSLTPROC@ convert-to-inline-style.xsl $< > $@

mathml-logo-640x200.png: mathml-logo-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -w 640 -e $@

mathml-logo-320x100.png: mathml-logo-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -w 320 -e $@

mathml-logo-240x75.png: mathml-logo-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -w 240 -e $@

mathml-square-logo-500.png: mathml-square-logo-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -w 500 -e $@

mathml-square-logo-256.png: mathml-square-logo-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -w 256 -e $@

mathml-square-logo-128.png: mathml-square-logo-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -w 128 -e $@

mathml-square-logo-64.png: mathml-square-logo-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -w 64 -e $@

%.pdf: %-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -E $@

%.eps: %-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -A $@

%-text-as-path.svg: %-inline-style.svg
	@INKSCAPE@ -f $< -C -T -y 0.0 -l $@-tmp
	@SCOUR@ -i $@-tmp -o $@ \
		--enable-comment-stripping \
		--enable-id-stripping
	rm $@-tmp
	touch $@

latinmodern-math.zip:
	@WGET@ $(LATIN_MODERN_MATH_URI) -O $@
	touch $@

texgyreheros.zip:
	@WGET@ $(TEX_GYRE_HEROS_URI) -O $@
	touch $@

latinmodern-math.otf: latinmodern-math.zip
	@UNZIP@ -j $< latinmodern-math-1959/otf/$@
	touch $@

texgyreheros-regular.otf: texgyreheros.zip
	@UNZIP@ -j $< $@
	touch $@

%.woff: %.otf
	@SFNT2WOFF@ $<

clean:
	rm -f *.eps *.png *.pdf *.otf *.woff *-text-as-path.svg \
	      *-inline-style.svg

distclean: clean
	rm -rf *.zip
